package rina.onepop.club.client.module.exploit;

import net.minecraft.init.Items;
import net.minecraft.network.play.client.CPacketPlayerTryUseItem;
import net.minecraft.util.EnumHand;
import rina.onepop.club.api.module.Module;
import rina.onepop.club.api.module.impl.ModuleCategory;
import rina.onepop.club.api.module.registry.Registry;
import rina.onepop.club.api.util.client.KeyUtil;
import rina.onepop.club.api.util.client.NullUtil;

/**
 * @author SrRina
 * @since 02/07/2021 at 00:24
 **/
@Registry(name = "No Eat Delay", tag = "No delay for eat.", description = "No delay for eat.", category = ModuleCategory.EXPLOIT)
public class ModuleNoEatDelay extends Module {
    private boolean pressed;
    private int lastItemCount;

    @Override
    public void onSetting() {
    }

    @Override
    public void onRender3D() {
        if (NullUtil.isPlayerWorld()) {
            return;
        }

        final EnumHand hand = this.getHandUse();

        if (hand == null) {
            this.pressed = false;

            return;
        }

        if (mc.gameSettings.keyBindUseItem.isKeyDown()) {
            this.pressed = true;

            KeyUtil.press(mc.gameSettings.keyBindUseItem, false);
            mc.gameSettings.keyBindUseItem.pressed = true;
        }

        if (this.pressed) {
            mc.player.connection.sendPacket(new CPacketPlayerTryUseItem(hand));
            mc.player.getHeldItem(hand).useItemRightClick(mc.world, mc.player, hand);

            mc.playerController.processRightClick(mc.player, mc.world, hand);
        }

        int i = mc.player.getHeldItem(hand).getCount();

        if (i != this.lastItemCount) {
            this.lastItemCount = i;
        }
    }

    public EnumHand getHandUse() {
        if (mc.player.getHeldItemMainhand().getItem() == Items.GOLDEN_APPLE || mc.player.getHeldItemOffhand().getItem() == Items.GOLDEN_APPLE) {
            return mc.player.getHeldItemMainhand().getItem() == Items.GOLDEN_APPLE ? EnumHand.MAIN_HAND : EnumHand.OFF_HAND;
        }

        return null;
    }
}
